<ion-header [translucent]="true" class="ion-no-border">
  <ion-toolbar>
    <ion-title>LED Cube 4x4x4 Controller</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">LED Cube Controller</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Connection Controls -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>🔌 Connection</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-button 
        (click)="connect()" 
        [disabled]="isConnected"
        color="primary">
        🔌 Connect
      </ion-button>
      <ion-button 
        (click)="disconnect()" 
        [disabled]="!isConnected"
        color="danger">
        ❌ Disconnect
      </ion-button>
      <ion-chip [color]="isConnected ? 'success' : 'medium'">
        <ion-label>{{ isConnected ? 'Connected' : 'Disconnected' }}</ion-label>
      </ion-chip>
    </ion-card-content>
  </ion-card>

  <!-- Animation Controls -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>🎬 Animasi</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="animation-buttons">
        <ion-button 
          *ngFor="let anim of animations; let i = index"
          (click)="sendAnim(i + 1)"
          [disabled]="!isConnected"
          size="small"
          fill="outline">
          Play Animasi {{ i + 1 }}
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Template Code -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>📜 Template Code Arduino</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-accordion-group>
        <ion-accordion 
          *ngFor="let template of templates; let i = index"
          [value]="'template-' + i">
          <ion-item slot="header" color="light">
            <ion-label>{{ template.name }}</ion-label>
          </ion-item>
          <div class="ion-padding" slot="content">
            <ion-textarea
              [value]="template.code"
              readonly
              rows="8"
              class="code-textarea">
            </ion-textarea>
            <ion-button 
              (click)="sendAnim(i + 1)"
              [disabled]="!isConnected"
              size="small"
              color="secondary">
              ▶️ Play {{ template.name }}
            </ion-button>
          </div>
        </ion-accordion>
      </ion-accordion-group>
    </ion-card-content>
  </ion-card>

  <!-- Matrix Editor -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>🎨 Matrix Editor (4x4)</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="matrix-grid">
        <div 
          *ngFor="let cell of matrix; let i = index"
          class="matrix-cell"
          [class.on]="cell === 1"
          (click)="toggleCell(i)">
        </div>
      </div>
      <ion-button (click)="exportMatrix()" color="tertiary">
        Export JSON
      </ion-button>
      <ion-textarea
        [(ngModel)]="matrixJson"
        readonly
        placeholder="Matrix JSON akan tampil di sini..."
        rows="4"
        class="json-textarea">
      </ion-textarea>
    </ion-card-content>
  </ion-card>

  <!-- Log Messages -->
  <ion-card *ngIf="logMessages.length > 0">
    <ion-card-header>
      <ion-card-title>📋 Log</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let msg of logMessages.slice(-5)">
          <ion-label>{{ msg }}</ion-label>
        </ion-item>
      </ion-list>
      <ion-button 
        (click)="clearLog()" 
        size="small" 
        fill="clear" 
        color="medium">
        Clear Log
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Fixed Bottom Container -->
  <div class="fixed-bottom-container">
    <app-bottom-nav (navigate)="onNavigate($event)"></app-bottom-nav>
  </div>
</ion-content>