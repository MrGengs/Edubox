<ion-content [fullscreen]="true" class="ion-padding" scrollY="false">
  <div class="login-container">
    <div class="logo-container">
      <ion-img src="assets/images/logo.png" class="logo"></ion-img>
      <h1>Selamat Datang</h1>
      <p>Silakan masuk untuk melanjutkan</p>
    </div>

    <form (ngSubmit)="login()" [formGroup]="loginForm" class="ion-margin-top">
      <div class="form-group">
        <ion-label class="input-label">Email</ion-label>
        <ion-item lines="none" class="input-item" [class.ion-invalid]="loginForm.get('email')?.touched && loginForm.get('email')?.invalid">
          <ion-icon name="mail-outline" slot="start"></ion-icon>
          <ion-input 
            type="email" 
            formControlName="email"
            required
            autocomplete="email"
            placeholder="Masukkan email Anda"
            [class.invalid]="loginForm.get('email')?.touched && loginForm.get('email')?.invalid">
          </ion-input>
        </ion-item>
        <ion-note class="error-message" *ngIf="loginForm.get('email')?.touched && loginForm.get('email')?.errors?.['required']">
          Email harus diisi
        </ion-note>
        <ion-note class="error-message" *ngIf="loginForm.get('email')?.touched && loginForm.get('email')?.errors?.['email']">
          Format email tidak valid
        </ion-note>
      </div>

      <div class="form-group">
        <ion-label class="input-label">Password</ion-label>
        <ion-item lines="none" class="input-item" [class.ion-invalid]="loginForm.get('password')?.touched && loginForm.get('password')?.invalid">
          <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
          <ion-input 
            [type]="showPassword ? 'text' : 'password'"
            formControlName="password"
            required
            minlength="6"
            placeholder="Masukkan password Anda"
            autocomplete="current-password"
            [class.invalid]="loginForm.get('password')?.touched && loginForm.get('password')?.invalid">
          </ion-input>
          <ion-button 
            fill="clear" 
            slot="end" 
            (click)="togglePassword()"
            class="ion-no-password-toggle"
            aria-label="Show/hide password">
            <ion-icon 
              [name]="showPassword ? 'eye-off-outline' : 'eye-outline'"
              slot="icon-only">
            </ion-icon>
          </ion-button>
        </ion-item>
        <ion-note class="error-message" *ngIf="loginForm.get('password')?.touched && loginForm.get('password')?.errors?.['required']">
          Password harus diisi
        </ion-note>
        <ion-note class="error-message" *ngIf="loginForm.get('password')?.touched && loginForm.get('password')?.errors?.['minlength']">
          Password minimal 6 karakter
        </ion-note>
      </div>

      <!-- Remember Me & Forgot Password -->
      <div class="form-options ion-margin-top">
        <ion-item lines="none" class="remember-me">
          <ion-checkbox slot="start" formControlName="rememberMe"></ion-checkbox>
          <ion-label>Ingat Saya</ion-label>
        </ion-item>
        <a class="forgot-password" (click)="goToForgotPassword()">Lupa Password?</a>
      </div>

      <!-- Error Message -->
      <div *ngIf="errorMessage" class="error-message ion-text-center ion-padding">
        <ion-text color="danger">
          <small>{{ errorMessage }}</small>
        </ion-text>
      </div>

      <ion-button 
        expand="block" 
        type="submit" 
        [disabled]="!loginForm.valid || isLoading"
        class="ion-margin-top">
        <ion-spinner name="crescent" *ngIf="isLoading"></ion-spinner>
        <span *ngIf="!isLoading">Masuk</span>
      </ion-button>

      <div class="divider">
        <span>atau</span>
      </div>

      <div class="login-options">
        <!-- Google Login Button -->
        <ion-button expand="block" fill="outline" class="google-login-btn" (click)="loginWithGoogle()" [disabled]="isGoogleLoading">
          <div class="google-button-content">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="google-logo">
              <path d="M17.5781 9.20156C17.5781 8.58281 17.5298 7.99375 17.4414 7.42344H9.14062V10.85H13.8594C13.7 11.9 13.1 12.75 12.1766 13.3V15.45H14.9C16.6578 13.8437 17.5781 11.7 17.5781 9.20156Z" fill="#4285F4"/>
              <path d="M9.14062 18C11.3828 18 13.2609 17.25 14.9 15.45L12.1766 13.3C11.3937 13.8 10.3938 14.1 9.14062 14.1C6.96484 14.1 5.12969 12.7 4.44531 10.8H1.60938V12.95C3.24063 16.15 5.96875 18 9.14062 18Z" fill="#34A853"/>
              <path d="M4.44531 10.8C4.24531 10.25 4.13281 9.65625 4.13281 9C4.13281 8.34375 4.24531 7.75 4.44531 7.2V5.05H1.60938C0.939062 6.3 0.5625 7.7 0.5625 9C0.5625 10.3 0.939062 11.7 1.60938 12.95L4.44531 10.8Z" fill="#FBBC05"/>
              <path d="M9.14062 3.9C10.4688 3.9 11.6328 4.35 12.5578 5.2L14.9578 2.8C13.2609 1.2 11.3828 0 9.14062 0C5.96875 0 3.24062 1.85 1.60938 5.05L4.44531 7.2C5.12969 5.3 6.96484 3.9 9.14062 3.9Z" fill="#EA4335"/>
            </svg>
            <span class="google-button-text">
              {{ isGoogleLoading ? 'Memeriksa akun...' : 'Masuk dengan Google' }}
            </span>
            <ion-spinner *ngIf="isGoogleLoading" name="crescent" class="google-spinner"></ion-spinner>
          </div>
        </ion-button>
      </div>

      <!-- Modal untuk memilih akun Google -->
      <ion-modal [isOpen]="showGoogleAccounts" [backdropDismiss]="false">
        <ng-template>
          <ion-header>
            <ion-toolbar>
              <ion-title>Pilih Akun Google</ion-title>
              <ion-buttons slot="end">
                <ion-button (click)="showGoogleAccounts = false">Tutup</ion-button>
              </ion-buttons>
            </ion-toolbar>
          </ion-header>
          <ion-content class="ion-padding">
            <ion-list>
              <ion-item *ngFor="let account of googleAccounts" button (click)="selectGoogleAccount(account)">
                <ion-avatar slot="start">
                  <img [src]="account.photoURL || 'assets/icon/avatar.png'" alt="Profile">
                </ion-avatar>
                <ion-label>
                  <h2>{{ account.displayName || 'Pengguna' }}</h2>
                  <p>{{ account.email }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-content>
        </ng-template>
      </ion-modal>

      <div class="register-link ion-text-center ion-margin-top">
        <p>Belum punya akun? <a (click)="goToRegister()" class="register-text">Daftar disini</a></p>
      </div>
    </form>
  </div>
</ion-content>
