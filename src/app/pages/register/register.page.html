<ion-content [fullscreen]="true" class="ion-padding">
  <div class="register-container">
    <div class="logo-container">
      <ion-img src="assets/images/logo.png" class="logo"></ion-img>
      <h1>Buat Akun Baru</h1>
      <p>Silakan isi data diri Anda</p>
    </div>

    <form
      (ngSubmit)="onRegister()"
      [formGroup]="registerForm"
      class="ion-margin-top"
      #form="ngForm"
    >
      <!-- Nama -->
      <div class="form-group">
        <ion-label class="input-label">Nama Lengkap</ion-label>
        <ion-item
          lines="none"
          class="input-item"
          [class.ion-invalid]="registerForm.get('name')?.touched && registerForm.get('name')?.invalid"
        >
          <ion-icon name="person" slot="start"></ion-icon>
          <ion-input
            type="text"
            formControlName="name"
            required
            autocomplete="name"
            (ionBlur)="registerForm.get('name')?.markAsTouched()"
          >
          </ion-input>
        </ion-item>
        <ion-note
          class="error-message"
          *ngIf="registerForm.get('name')?.touched && registerForm.get('name')?.invalid"
        >
          {{ getError('name') }}
        </ion-note>
      </div>

      <!-- Email -->
      <div class="form-group">
        <ion-label class="input-label">Email</ion-label>
        <ion-item
          lines="none"
          class="input-item"
          [class.ion-invalid]="registerForm.get('email')?.touched && registerForm.get('email')?.invalid"
        >
          <ion-icon name="mail" slot="start"></ion-icon>
          <ion-input
            type="email"
            formControlName="email"
            required
            autocomplete="email"
            (ionBlur)="registerForm.get('email')?.markAsTouched()"
          >
          </ion-input>
        </ion-item>
        <ion-note
          class="error-message"
          *ngIf="registerForm.get('email')?.touched && registerForm.get('email')?.invalid"
        >
          {{ getError('email') }}
        </ion-note>
      </div>

      <!-- Password -->
      <div class="form-group">
        <div class="password-header">
          <ion-label class="input-label">Password</ion-label>
          <ion-note class="strength-meter" *ngIf="passwordStrength > 0">
            Kekuatan: {{ passwordStrengthText }}
          </ion-note>
        </div>
        <ion-item
          lines="none"
          class="input-item"
          [class.ion-invalid]="registerForm.get('password')?.touched && registerForm.get('password')?.invalid"
        >
          <ion-icon name="lock-closed" slot="start"></ion-icon>
          <ion-input
            [type]="showPassword ? 'text' : 'password'"
            formControlName="password"
            (ionBlur)="registerForm.get('password')?.markAsTouched()"
            required
            minlength="6"
            autocomplete="new-password"
            style="--padding-end: 1em;"
          >
          </ion-input>
          <ion-button
            fill="clear"
            slot="end"
            (click)="togglePassword('password')"
            aria-label="Show/hide password"
            class="password-toggle"
          >
            <ion-icon
              [name]="showPassword ? 'eye-off-outline' : 'eye-outline'"
            ></ion-icon>
          </ion-button>
        </ion-item>
        <div class="password-strength">
          <div class="strength-bar">
            <div
              class="strength-fill"
              [style.width.%]="passwordStrength"
              [ngClass]="getPasswordStrengthClass()"
            ></div>
          </div>
        </div>
        <ion-note
          class="error-message"
          *ngIf="registerForm.get('password')?.touched && registerForm.get('password')?.invalid"
        >
          {{ getError('password') }}
        </ion-note>
        <ion-note
          class="hint"
          *ngIf="!registerForm.get('password')?.hasError('required')"
        >
          <ion-icon name="information-circle"></ion-icon>
          Gunakan minimal 6 karakter dengan kombinasi huruf dan angka
        </ion-note>
      </div>

      <!-- Confirm Password -->
      <div class="form-group">
        <ion-label class="input-label">Konfirmasi Password</ion-label>
        <ion-item
          lines="none"
          class="input-item"
          [class.ion-invalid]="registerForm.get('confirmPassword')?.touched && registerForm.get('confirmPassword')?.invalid"
        >
          <ion-icon name="lock-closed" slot="start"></ion-icon>
          <ion-input
            [type]="showConfirmPassword ? 'text' : 'password'"
            formControlName="confirmPassword"
            (ionBlur)="registerForm.get('confirmPassword')?.markAsTouched()"
            required
            autocomplete="new-password"
            style="--padding-end: 1em;"
          >
          </ion-input>
          <ion-button
            fill="clear"
            slot="end"
            (click)="togglePassword('confirmPassword')"
            aria-label="Show/hide confirm password"
            class="password-toggle"
          >
            <ion-icon
              [name]="showConfirmPassword ? 'eye-off-outline' : 'eye-outline'"
            ></ion-icon>
          </ion-button>
        </ion-item>
        <ion-note
          class="error-message"
          *ngIf="registerForm.get('confirmPassword')?.touched && registerForm.get('confirmPassword')?.invalid"
        >
          {{ getError('confirmPassword') }}
        </ion-note>
      </div>

      <!-- Terms and Conditions -->
      <div class="terms-container ion-margin-top">
        <ion-item lines="none" class="terms-item">
          <ion-checkbox
            slot="start"
            [formControl]="termsControl"
            class="custom-checkbox"
            aria-label="Setuju dengan syarat dan ketentuan"
          ></ion-checkbox>
          <ion-label class="ion-text-wrap terms-label">
            Saya menyetujui
            <a (click)="openTerms()" class="terms-link">Syarat & Ketentuan</a> dan
            <a (click)="openPrivacyPolicy()" class="terms-link">Kebijakan Privasi</a>
            <span class="required-asterisk">*</span>
          </ion-label>
        </ion-item>
        <ion-note
          class="error-message"
          *ngIf="registerForm.get('terms')?.touched && registerForm.get('terms')?.invalid"
        >
          {{ getError('terms') }}
        </ion-note>
      </div>

      <!-- Register Button -->
      <ion-button
        expand="block"
        type="submit"
        class="register-button"
        [disabled]="!registerForm.valid || isLoading"
        shape="round"
      >
        <div class="button-content">
          <span *ngIf="!isLoading">Daftar</span>
          <ion-spinner
            *ngIf="isLoading"
            name="crescent"
            class="button-spinner"
          ></ion-spinner>
        </div>
      </ion-button>

      <!-- Divider -->
      <div class="divider">
        <span class="divider-line"></span>
        <span class="divider-text">atau</span>
        <span class="divider-line"></span>
      </div>

      <!-- Google Sign Up Button -->
      <ion-button
        expand="block"
        fill="outline"
        class="google-login-btn"
        (click)="signInWithGoogle()"
        [disabled]="isGoogleLoading"
      >
        <div class="google-button-content">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="google-logo">
            <path d="M17.5781 9.20156C17.5781 8.58281 17.5298 7.99375 17.4414 7.42344H9.14062V10.85H13.8594C13.7 11.9 13.1 12.75 12.1766 13.3V15.45H14.9C16.6578 13.8437 17.5781 11.7 17.5781 9.20156Z" fill="#4285F4"/>
            <path d="M9.14062 18C11.3828 18 13.2609 17.25 14.9 15.45L12.1766 13.3C11.3937 13.8 10.3938 14.1 9.14062 14.1C6.96484 14.1 5.12969 12.7 4.44531 10.8H1.60938V12.95C3.24063 16.15 5.96875 18 9.14062 18Z" fill="#34A853"/>
            <path d="M4.44531 10.8C4.24531 10.25 4.13281 9.65625 4.13281 9C4.13281 8.34375 4.24531 7.75 4.44531 7.2V5.05H1.60938C0.939062 6.3 0.5625 7.7 0.5625 9C0.5625 10.3 0.939062 11.7 1.60938 12.95L4.44531 10.8Z" fill="#FBBC05"/>
            <path d="M9.14062 3.9C10.4688 3.9 11.6328 4.35 12.5578 5.2L14.9578 2.8C13.2609 1.2 11.3828 0 9.14062 0C5.96875 0 3.24062 1.85 1.60938 5.05L4.44531 7.2C5.12969 5.3 6.96484 3.9 9.14062 3.9Z" fill="#EA4335"/>
          </svg>
          <span class="google-button-text">
            {{ isGoogleLoading ? 'Memproses...' : 'Daftar dengan Google' }}
          </span>
          <ion-spinner *ngIf="isGoogleLoading" name="crescent" class="google-spinner"></ion-spinner>
        </div>
      </ion-button>

      <div class="login-link ion-text-center ion-margin-top">
        <p>
          Sudah punya akun?
          <a routerLink="/login" class="login-link-text">Masuk Sekarang</a>
        </p>
      </div>
    </form>
  </div>
</ion-content>
